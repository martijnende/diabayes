
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Inverse modelling &#8212; DiaBayes  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user-guide/inversion/index';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Maximum-likelihood inversion" href="max-likelihood.html" />
    <link rel="prev" title="Spring-blocks" href="../forward/spring-block.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">DiaBayes  documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting-started.html">
    Getting started
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../community.html">
    DiaBayes Community
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting-started.html">
    Getting started
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../community.html">
    DiaBayes Community
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../friction_experiments.html">Rock friction experiments</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../forward/index.html">Forward modelling</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../forward/rate-and-state.html">Rate-and-state friction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../forward/chen-niemeijer-spiers.html">Chen-Niemeijer-Spiers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../forward/spring-block.html">Spring-blocks</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="current reference internal" href="#">Inverse modelling</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="max-likelihood.html">Maximum-likelihood inversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="bayesian.html">Bayesian inversion</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_usage.html">Advanced use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../adding_features.html">Adding custom physics</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Inverse modelling</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="inverse-modelling">
<h1>Inverse modelling<a class="headerlink" href="#inverse-modelling" title="Link to this heading">#</a></h1>
<p>Given a set of observations <span class="math notranslate nohighlight">\(\mu_{obs}(t)\)</span> (i.e., a <em>friction curve</em>), and a suitable <a class="reference internal" href="../forward/index.html"><span class="doc std std-doc">forward model</span></a> with parameters <span class="math notranslate nohighlight">\(\mathcal{P}\)</span>, what are the parameter values that can explain the observations? We could choose some random <span class="math notranslate nohighlight">\(\mathcal{P}\)</span>, run a forward simulation, and see if the forward solution <span class="math notranslate nohighlight">\(\mu(t) = \mathrm{Forward}[t, \mathcal{P}]\)</span> matches <span class="math notranslate nohighlight">\(\mu_{obs}(t)\)</span>. If not, change <span class="math notranslate nohighlight">\(\mathcal{P}\)</span> a little bit and try again, until an acceptable agreement between <span class="math notranslate nohighlight">\(\mu(t)\)</span> and <span class="math notranslate nohighlight">\(\mu_{obs}(t)\)</span> is found.</p>
<p>Of course, we can do this more systematically. Define an objective function (or “loss” function in Machine/Deep Learning jargon):</p>
<div class="math notranslate nohighlight" id="equation-loss-fn">
<span class="eqno">(1)<a class="headerlink" href="#equation-loss-fn" title="Link to this equation">#</a></span>\[\mathcal{L} = \frac{1}{T} \int_0^T \left(\mu_{obs} - \mathrm{Forward}[t, \mathcal{P}] \right)^2 \mathrm{d} t\]</div>
<p>In practice, the integral over <span class="math notranslate nohighlight">\(t\)</span> is replaced by a summation (since <span class="math notranslate nohighlight">\(\mu_{obs}\)</span> is sampled at discrete time intervals), but for the theory it makes sense to keep the integral for now. The “best” parameter values are those that result in the smallest value of <span class="math notranslate nohighlight">\(\mathcal{L}\)</span>, i.e.:</p>
<div class="math notranslate nohighlight">
\[\mathcal{P}^* = \underset{\mathcal{P}}{\arg \min} \, \left\{ \frac{1}{T} \int_0^T \left(\mu_{obs} - \mathrm{Forward}[t, \mathcal{P}] \right)^2 \mathrm{d} t \right\}\]</div>
<p>A classical approach to finding <span class="math notranslate nohighlight">\(\mathcal{P}^*\)</span> is performing gradient descent on Eq. <a class="reference internal" href="#equation-loss-fn">(1)</a>: we compute the gradient of <span class="math notranslate nohighlight">\(\mathcal{L}\)</span> with respect to <span class="math notranslate nohighlight">\(\mathcal{P}\)</span>, and then take a small step down the gradient. By repeating this procedure multiple times, we expect to eventually arrive at the (local) minimum, where the gradients are zero (and so we automatically stop there). Quantitatively, this reads:</p>
<div class="math notranslate nohighlight">
\[\mathcal{P}^{i+1} = \mathcal{P}^i - \eta \left.\frac{\mathrm{d} \mathcal{L}}{\mathrm{d} \mathcal{P}} \right\vert_{\mathcal{P}^i}\]</div>
<p>There are more advanced gradient-descent algorithms, like Adam<a class="footnote-reference brackets" href="#footcite-kingma2014" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> (as used by DiaBayes), but they are all just different flavours of this general concept.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>When the number of invertible parameter exceeds 1, <span class="math notranslate nohighlight">\(\mathcal{P}\)</span> becomes a vector. A more precise notation would be to use a vector arrow <span class="math notranslate nohighlight">\(\vec{\mathcal{P}}\)</span> to distinguish it from a scalar, but for ease of reading (and writing…) I will drop the arrow everywhere in these sections.</p>
</div>
<p>The challenge now is to find the derivative term on the right-hand side. By virtue of the <a class="reference external" href="https://en.wikipedia.org/wiki/Leibniz_integral_rule">Leibniz integral rule</a>, the total derivative of <span class="math notranslate nohighlight">\(\mathcal{L}\)</span> becomes a partial derivative of <span class="math notranslate nohighlight">\(\mathrm{Forward}[t, \mathcal{P}]\)</span> with respect to <span class="math notranslate nohighlight">\(\mathcal{P}\)</span> inside the integral. But how does one differentiate the solution of an ODE with respect to its parameters? The solution at any point <span class="math notranslate nohighlight">\(t_i\)</span> depends on the entire history from <span class="math notranslate nohighlight">\(t = t_0\)</span> up to <span class="math notranslate nohighlight">\(t_i\)</span>, and so the derivatives at time <span class="math notranslate nohighlight">\(t_i\)</span> depend on the derivatives at <span class="math notranslate nohighlight">\(t_{i-1}, t_{i-2}, \dots\)</span>. Fortunately, there is an elegant approach to solve this recursive problem, which is called the <a class="reference external" href="https://en.wikipedia.org/wiki/Adjoint_state_method"><em>adjoint state method</em></a> (or simply “adjoint method”).</p>
<p>It is beyond the scope of the user guide to explain this method here, but there are numerous lecture notes and blog posts out there that describe this approach in the context of continuous-time ODEs (and also Neural ODEs<a class="footnote-reference brackets" href="#footcite-chen2018-neuralode" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>). Conveniently, this method is built into the solvers of the <a class="reference external" href="https://docs.kidger.site/diffrax/">Diffrax</a> library<a class="footnote-reference brackets" href="#footcite-kidger2021" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>, and so in the spirit of the underlying JAX library, any operations involving an ODE solution are differentiable with respect to its parameters. DiaBayes builds further on this, integrating the gradients coming out of the adjoint back-propagation into gradient-based inversion algorithms. DiaBayes implements two flavours of inversion methods, which are the <a class="reference internal" href="max-likelihood.html"><span class="doc std std-doc">maximum-likelihood inversion</span></a> and <a class="reference internal" href="bayesian.html"><span class="doc std std-doc">Bayesian inversion</span></a> that are discussed in the next sections.</p>
<div class="toctree-wrapper compound">
</div>
<p class="rubric">References</p>
<div class="docutils container" id="id4">
</div>
</section>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="footcite-kingma2014" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Diederik P. Kingma and Jimmy Ba. Adam: a method for stochastic optimization. 2014. <a class="reference external" href="https://doi.org/10.48550/ARXIV.1412.6980">doi:10.48550/ARXIV.1412.6980</a>.</p>
</aside>
<aside class="footnote brackets" id="footcite-chen2018-neuralode" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Ricky T. Q. Chen, Yulia Rubanova, Jesse Bettencourt, and David Duvenaud. Neural ordinary differential equations. 2018. <a class="reference external" href="https://doi.org/10.48550/ARXIV.1806.07366">doi:10.48550/ARXIV.1806.07366</a>.</p>
</aside>
<aside class="footnote brackets" id="footcite-kidger2021" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>Patrick Kidger. <em>On Neural Differential Equations</em>. PhD thesis, University of Oxford, 2021.</p>
</aside>
</aside>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../forward/spring-block.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Spring-blocks</p>
      </div>
    </a>
    <a class="right-next"
       href="max-likelihood.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Maximum-likelihood inversion</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, Martijn van den Ende.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>