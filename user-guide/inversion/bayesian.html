
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Bayesian inversion &#8212; DiaBayes  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user-guide/inversion/bayesian';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Advanced use cases" href="../advanced_usage.html" />
    <link rel="prev" title="Maximum-likelihood inversion" href="max-likelihood.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">DiaBayes  documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting-started.html">
    Getting started
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../community.html">
    DiaBayes Community
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting-started.html">
    Getting started
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../community.html">
    DiaBayes Community
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../friction_experiments.html">Rock friction experiments</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../forward/index.html">Forward modelling</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../forward/rate-and-state.html">Rate-and-state friction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../forward/chen-niemeijer-spiers.html">Chen-Niemeijer-Spiers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../forward/spring-block.html">Spring-blocks</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Inverse modelling</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="max-likelihood.html">Maximum-likelihood inversion</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Bayesian inversion</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_usage.html">Advanced use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../adding_features.html">Adding custom physics</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">User Guide</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Inverse modelling</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Bayesian inversion</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="bayesian-inversion">
<h1>Bayesian inversion<a class="headerlink" href="#bayesian-inversion" title="Link to this heading">#</a></h1>
<p>Bayesian inversion refers to a family of inversion methods that aim to estimate the <em>probability</em> that a given set of parameters <span class="math notranslate nohighlight">\(\mathcal{P}\)</span> can explain the measured data <span class="math notranslate nohighlight">\(\mu_{obs}\)</span>. This probability is expressed in terms of the <em>posterior distribution</em> over the parameters, which comprises a likelihood term and a prior probability term, usually written as:</p>
<div class="math notranslate nohighlight" id="equation-eq-bayes">
<span class="eqno">(1)<a class="headerlink" href="#equation-eq-bayes" title="Link to this equation">#</a></span>\[p\left(\mathcal{P} | \mu_{obs} \right) \propto p\left(\mu_{obs} | \mathcal{P} \right) p\left(\mathcal{P}\right)\]</div>
<p>For those new to Bayesian statistics: <span class="math notranslate nohighlight">\(p\left(a|b \right)\)</span> is read as “the probability that <span class="math notranslate nohighlight">\(a\)</span> is true given that <span class="math notranslate nohighlight">\(b\)</span> is true” (loosely speaking). The first term on the right-hand side is called the <em>likelihood</em> term, and the second term is the <em>prior</em> probability (or simply “prior”). The likelihood term can be estimated by running a forward simulation (with a given <span class="math notranslate nohighlight">\(\mathcal{P}\)</span>) and calculating the mismatch with the observations; the maximum-likelihood inversion discussed in <a class="reference internal" href="max-likelihood.html"><span class="doc std std-doc">the previous section</span></a> aims to find <span class="math notranslate nohighlight">\(\mathcal{P}\)</span> that maximises this term. However, Bayesian inversion also takes into account that one might have a-priori information about <span class="math notranslate nohighlight">\(\mathcal{P}\)</span> itself, before observing any data (the prior). For example, we might expect <span class="math notranslate nohighlight">\(\mathcal{P}\)</span> to be positive, or be constrained by independent measurements, etc. Lastly, the proportionality constant, which quantifies the probability of observing the data, is unknown but irrelevant for the inversion.</p>
<section id="gradients-of-the-posterior">
<h2>Gradients of the posterior<a class="headerlink" href="#gradients-of-the-posterior" title="Link to this heading">#</a></h2>
<p>In practice, most Bayesian inversion methods sample the logaritm of <span class="math notranslate nohighlight">\(p\)</span>, hence Eq. <a class="reference internal" href="#equation-eq-bayes">(1)</a> becomes:</p>
<div class="math notranslate nohighlight" id="equation-eq-logbayes">
<span class="eqno">(2)<a class="headerlink" href="#equation-eq-logbayes" title="Link to this equation">#</a></span>\[\ln p\left(\mathcal{P} | \mu_{obs} \right) \propto \ln p\left(\mu_{obs} | \mathcal{P} \right) + \ln p\left(\mathcal{P}\right)\]</div>
<p>To permit an informed exploration of the posterior distribution, gradient information is used to guide the search direction within the parameter space. To see how our forward simulations fit into this, let’s consider a normal (Gaussian) likelihood distribution:</p>
<div class="math notranslate nohighlight" id="equation-eq-gaussian">
<span class="eqno">(3)<a class="headerlink" href="#equation-eq-gaussian" title="Link to this equation">#</a></span>\[p\left(\mu_{obs} | \mathcal{P} \right) \propto \prod_t \exp \left( - \left[ \frac{\mu_{obs}(t) - \mathrm{Forward}\left[t, \mathcal{P}\right]}{\sqrt{2} \nu} \right]^2 \right)\]</div>
<p>To avoid confusion with the normal stress (often denoted <span class="math notranslate nohighlight">\(\sigma\)</span>), the standard deviation (also often denoted by <span class="math notranslate nohighlight">\(\sigma\)</span>) is here denoted by <span class="math notranslate nohighlight">\(\nu\)</span>. This standard deviation is expected to be proportional to the measurement noise amplitude in <span class="math notranslate nohighlight">\(\mu_{obs}\)</span>. The logarithm of Eq. <a class="reference internal" href="#equation-eq-gaussian">(3)</a> turns the product into a summation:</p>
<div class="math notranslate nohighlight" id="equation-eq-log-gaussian">
<span class="eqno">(4)<a class="headerlink" href="#equation-eq-log-gaussian" title="Link to this equation">#</a></span>\[\ln p\left(\mu_{obs} | \mathcal{P} \right) \propto - \sum_t \left[ \frac{\mu_{obs}(t) - \mathrm{Forward}\left[t, \mathcal{P}\right]}{\sqrt{2} \nu} \right]^2\]</div>
<p>Lastly, the derivative of the log-likelihood with respect to <span class="math notranslate nohighlight">\(\mathcal{P}\)</span> can then be found by virtue of the chain rule, and differentiation through the ODE solution:</p>
<div class="math notranslate nohighlight" id="equation-eq-grad-log-gaussian">
<span class="eqno">(5)<a class="headerlink" href="#equation-eq-grad-log-gaussian" title="Link to this equation">#</a></span>\[\frac{\partial \ln p\left(\mu_{obs} | \mathcal{P} \right)}{\partial \mathcal{P}} \propto \sum_t \frac{\mu_{obs}(t) - \mathrm{Forward}\left[t, \mathcal{P}\right]}{2 \nu^2} \frac{\partial \mathrm{Forward}}{\partial \mathcal{P}}\]</div>
<p>Because of the differentiability of the DiaBayes forward models, the gradient term on the right-hand side can be precisely calculated. A similar procedure is applied to obtain the gradients of the prior distribution.</p>
<p>By doing gradient descent on <span class="math notranslate nohighlight">\(-\partial \ln p\left(\mu_{obs} | \mathcal{P} \right) / \partial \mathcal{P}\)</span>, one arrives as the maximum a-posteriori estimate, which strikes a balance between the likelihood and prior terms. But this is not what we want: the point of doing Bayesian inversion, is to gain insight into the <em>distribution</em> of parameter probabilities, not just a single estimate thereof. To estimate the posterior distribution, one needs to perform some kind of sampling of the neighbourhood around the maximum posterior. There are numerous methods that can do this, many of which have been implemented into the <a class="reference external" href="https://blackjax-devs.github.io/blackjax/">Blackjax</a> library. However, DiaBayes implements its own Bayesian sampler: <em>Stein Variational Inference</em>.</p>
</section>
<section id="stein-variational-inference">
<h2>Stein Variational Inference<a class="headerlink" href="#stein-variational-inference" title="Link to this heading">#</a></h2>
<p>Stein Variational Inference (SVI) through <em>Stein Variational Gradient Descent</em><a class="footnote-reference brackets" href="#footcite-liu2016" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> is a particle-swarm optimisation method in which each particle represents one sample from the posterior distribution. The particles can move around in a space with the same number of dimensions as the number of invertible parameters. They are attracted towards the maximum in the likelihood and the prior propabilities (through gradient descent on the negative log-likelihood and log-prior, see Eq. <a class="reference internal" href="#equation-eq-grad-log-gaussian">(5)</a>), and they repel one another based on their mutual distance. Eventually the particle swarm will find an equilibrium, after which the particle positions are fixed. This final distribution of the particles approximates the posterior distribution.</p>
<p>To get a statistically significant sample of the posterior distribution, we need <span class="math notranslate nohighlight">\(N \gg 1\)</span> particles, which scales with the number of invertible parameters. For an inversion of a classical rate-and-state friction model with 3 parameters, a sample size of <span class="math notranslate nohighlight">\(N = 1000\)</span> is a good starting point. And thanks to the <code class="docutils literal notranslate"><span class="pre">jax.vmap</span></code> functionality we can run <span class="math notranslate nohighlight">\(N\)</span> forward simulations in parallel on a GPU, so that doing the inversion with <span class="math notranslate nohighlight">\(N=100\)</span> is not necessarily much faster than with <span class="math notranslate nohighlight">\(N=1000\)</span>.</p>
<p>To find the equilibrium state, we randomly initialise the swarm of <span class="math notranslate nohighlight">\(N\)</span> particles in a ball around the maximum-likelihood estimate (see <a class="reference internal" href="max-likelihood.html"><span class="doc std std-doc">the previous section</span></a>), and allow for <span class="math notranslate nohighlight">\(T\)</span> update steps to converge towards the equilibrium state. During each step, we first calculate an “effective gradient” as defined by the SVI method:</p>
<div class="math notranslate nohighlight" id="equation-eq-svi">
<span class="eqno">(6)<a class="headerlink" href="#equation-eq-svi" title="Link to this equation">#</a></span>\[\begin{split}\begin{split}
\phi\left(\mathcal{P}_n \right) = \frac{1}{N} \sum_{i=1}^N \underbrace{\kappa \left(\mathcal{P}_n, \mathcal{P}_i \right) \frac{\partial \ln p \left(\mu_{obs} | \mathcal{P}_i \right)}{\partial \mathcal{P}_i}}_{\text{attraction to likelihood}} \\
+ \underbrace{\kappa \left(\mathcal{P}_n, \mathcal{P}_i \right) \frac{\partial \ln p \left(\mathcal{P}_i \right)}{\partial \mathcal{P}_i}}_{\text{attraction to prior}} \\
+ \underbrace{\kappa \left(\mathcal{P}_n, \mathcal{P}_i \right)}_{\text{repulsion}}
\end{split}\end{split}\]</div>
<p>Here, <span class="math notranslate nohighlight">\(\kappa(a, b)\)</span> denotes a function (the “kernel”) that equals to 1 when <span class="math notranslate nohighlight">\(a = b\)</span>, and decays to 0 when <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span> get farther removed from each other. DiaBayes uses a standard radial basis function combined with a Euclidean distance metric:</p>
<div class="math notranslate nohighlight" id="equation-eq-kernel">
<span class="eqno">(7)<a class="headerlink" href="#equation-eq-kernel" title="Link to this equation">#</a></span>\[\kappa(a, b) = \exp \left(- \frac{1}{h} ||a - b||_2^2 \right)\]</div>
<p>where <span class="math notranslate nohighlight">\(||x||_2\)</span> denotes the Euclidean norm of a vector, and <span class="math notranslate nohighlight">\(h\)</span> is calculated for the entire particle swarm using <a class="reference external" href="https://en.wikipedia.org/wiki/Median_trick">the median trick</a>. Then, each particle position is updated using a gradient-descent approach. For classical gradient descent, the update step looks like this:</p>
<div class="math notranslate nohighlight" id="equation-eq-svi-update">
<span class="eqno">(8)<a class="headerlink" href="#equation-eq-svi-update" title="Link to this equation">#</a></span>\[\mathcal{P}_n^{k+1} = \mathcal{P}_n^{k} - \eta \phi\left(\mathcal{P}_n^k \right)\]</div>
<p>However, DiaBayes employs the <a class="reference external" href="https://optax.readthedocs.io/en/latest/api/optimizers.html#optax.adam">Adam</a><a class="footnote-reference brackets" href="#footcite-kingma2014" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> implementation of the <a class="reference external" href="https://optax.readthedocs.io/en/latest/index.html">Optax</a> library for improved convergence, which employs a slightly different formulation.</p>
<p>After having converged over <span class="math notranslate nohighlight">\(T\)</span> steps, the final positions of the set of particles <span class="math notranslate nohighlight">\(\left\{ \mathcal{P} \right\}_{n=1}^N\)</span> represent the posterior probability distribution over the parameters.</p>
</section>
<section id="bayesian-analysis-in-diabayes">
<h2>Bayesian analysis in DiaBayes<a class="headerlink" href="#bayesian-analysis-in-diabayes" title="Link to this heading">#</a></h2>
<p>Concretely, if one wants to perform a Bayesian inversion of the forward model parameters, it only requires a single function call, e.g.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bayesian_result</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">bayesian_inversion</span><span class="p">(</span>
    <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">mu_measured</span><span class="p">,</span> <span class="n">noise_std</span><span class="o">=</span><span class="n">noise_std</span><span class="p">,</span>
    <span class="n">params</span><span class="o">=</span><span class="n">params_init</span><span class="p">,</span> <span class="n">friction_constants</span><span class="o">=</span><span class="n">constants</span><span class="p">,</span> 
    <span class="n">block_constants</span><span class="o">=</span><span class="n">block_constants</span><span class="p">,</span> 
    <span class="n">Nparticles</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span> <span class="n">Nsteps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The function call signature is very similar to that of the <code class="docutils literal notranslate"><span class="pre">diabayes.ODEsolver.max_likelihood_solver</span></code> routine, with a few additional arguments specific to the SVI method. The <code class="docutils literal notranslate"><span class="pre">examples/simple_inversion.ipynb</span></code> example notebook describes these arguments in detail, which will not be repeated here. This notebook also demonstrates how to use the various analysis tools that accompany the <code class="docutils literal notranslate"><span class="pre">bayesian_inversion</span></code> method, such as convergence checking and uncertainty visualisation.</p>
<p>What is important to clarify here, is that the prior distribution is currently not “properly” defined, at least not in the strict meaning of the term. In many (or even the majority) of Bayesian geophysics studies, the prior distribution is assumed to be uniform (also known as a “flat prior”). The corresponding gradients of this prior hence vanish (<span class="math notranslate nohighlight">\(\partial \ln p\left(\mathcal{P} \right) / \partial \mathcal{P} = 0\)</span>), causing the particles to settle around the likelihood distribution. This is not necessarily a bad strategy, because often there are no independent constraints on the parameters of the friction model, and a uniform prior accurately reflects this notion of “we don’t know what to expect”. On the other hand, we actually do know a bit more that: both empirically and theoretically, the rate-and-state friction parameters <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(D_c\)</span> are known to be strictly positive, and we expect them to exhibit a certain amplitude (e.g., <span class="math notranslate nohighlight">\(10^{-4} &lt; a &lt; 10^{-1}\)</span>). To somewhat account for this additional knowledge, DiaBayes opts to define a prior conditioned on the maximum-likelihood estimate <span class="math notranslate nohighlight">\(\mathcal{P}^*\)</span>, i.e.:</p>
<div class="math notranslate nohighlight">
\[p\left( \mathcal{P} \right) \approx q \left( \mathcal{P} | \mathcal{P}^* \right)\]</div>
<p>Because of this conditioning on <span class="math notranslate nohighlight">\(\mathcal{P}^*\)</span>, which itself in conditioned on the data <span class="math notranslate nohighlight">\(\mu_{obs}\)</span>, this choice of a prior cannot be considered a <em>true</em> prior. Nonetheless, it is a convenient choice to somewhat restrict the posterior distribution to parameter values that one would consider reasonable (assuming that the maximum-likelihood inversion found reasonable parameter values).</p>
<p>A second important clarification, is that currently DiaBayes solves the Bayesian problem in log-parameter space, i.e. <span class="math notranslate nohighlight">\(\mathcal{P} = \ln \mathcal{Q}\)</span>, with <span class="math notranslate nohighlight">\(\mathcal{Q}\)</span> representing the forward model parameters like <span class="math notranslate nohighlight">\(a\)</span>, <span class="math notranslate nohighlight">\(b\)</span>, <span class="math notranslate nohighlight">\(D_c\)</span> (in the case of rate-and-state friction). This strategy ensures that all the parameters <span class="math notranslate nohighlight">\(\mathcal{Q}\)</span> are strictly positive, which greatly improves the stability of the inversion; forward simulations with <span class="math notranslate nohighlight">\(a &lt; 0\)</span> are not only non-physical, they are also highly unstable. And simulations with <span class="math notranslate nohighlight">\(D_c &lt; 0\)</span> are not defined at all (logarithm of a negative number). Moreover, some parameters can vary by orders of magnitude, and hence solving the problem in log-space is a sensible choice. The flip-side of this strategy, is that some parameters that are normally not restricted to be positive (like the rate-and-state <span class="math notranslate nohighlight">\(b\)</span> parameter) cannot become negative, even if it is demanded by the observed data.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>TL;DR of the above:</p>
<ul class="simple">
<li><p>The DiaBayes prior distribution is conditioned on the maximum-likelihood solution.</p></li>
<li><p>The inversion is done on log-transformed parameters, hence the resulting values are strictly positive.</p></li>
</ul>
</div>
<div class="admonition-future-work admonition">
<p class="admonition-title">Future work</p>
<p>Future versions of DiaBayes will address the above restrictions by allowing for user-defined prior distribution functions.</p>
</div>
<p class="rubric">References</p>
<div class="docutils container" id="id3">
</div>
</section>
</section>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="footcite-liu2016" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Qiang Liu and Dilin Wang. Stein variational gradient descent: a general purpose bayesian inference algorithm. 2016. <a class="reference external" href="https://doi.org/10.48550/ARXIV.1608.04471">doi:10.48550/ARXIV.1608.04471</a>.</p>
</aside>
<aside class="footnote brackets" id="footcite-kingma2014" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Diederik P. Kingma and Jimmy Ba. Adam: a method for stochastic optimization. 2014. <a class="reference external" href="https://doi.org/10.48550/ARXIV.1412.6980">doi:10.48550/ARXIV.1412.6980</a>.</p>
</aside>
</aside>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="max-likelihood.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Maximum-likelihood inversion</p>
      </div>
    </a>
    <a class="right-next"
       href="../advanced_usage.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Advanced use cases</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gradients-of-the-posterior">Gradients of the posterior</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stein-variational-inference">Stein Variational Inference</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bayesian-analysis-in-diabayes">Bayesian analysis in DiaBayes</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, Martijn van den Ende.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>